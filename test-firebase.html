<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Diagnostics (Compat Mode)</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            line-height: 1.6;
        }

        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .pending {
            background: #fef3c7;
            color: #92400e;
        }

        .success {
            background: #d1fae5;
            color: #065f46;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
        }

        pre {
            background: #f1f5f9;
            padding: 10px;
            overflow-x: auto;
        }
    </style>

    <!-- Using Firebase Compat SDKs (Directly from CDN, works on file://) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>

<body>
    <h1>Firebase Diagnostic Tool</h1>
    <p>Using Compat Mode (Should work locally)</p>
    <div id="status" class="status pending">Initializing...</div>
    <div id="logs"></div>

    <script>
        // Your web app's Firebase configuration
        // (Copy-pasted from your config file)
        const firebaseConfig = {
            apiKey: "AIzaSyD89OYtoor7v6FjNENDNbbQXV8Nxe7gFAI",
            authDomain: "gen-lang-client-0663259310.firebaseapp.com",
            databaseURL: "https://gen-lang-client-0663259310-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gen-lang-client-0663259310",
            storageBucket: "gen-lang-client-0663259310.firebasestorage.app",
            messagingSenderId: "171862260005",
            appId: "1:171862260005:web:96e4c2b04013356c43c2cc"
        };

        const log = (msg) => {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('logs').appendChild(div);
            console.log(msg);
        };

        const setStatus = (type, msg) => {
            const el = document.getElementById('status');
            el.className = `status ${type}`;
            el.textContent = msg;
        };

        async function runDiagnostics() {
            try {
                log("Starting diagnostics (Compat Mode)...");
                log("1. Initializing Firebase App...");

                if (!firebase) throw new Error("Firebase script not loaded correctly from CDN.");
                const app = firebase.initializeApp(firebaseConfig);
                const db = firebase.firestore();

                log("Firebase Config OK.");

                log("2. Attempting Write to Firestore...");
                const testRef = db.collection("exot_diagnostics").doc("test_connection");
                const testData = { timestamp: Date.now(), status: "ok", mode: "compat" };

                await testRef.set(testData);
                log("Write Successful!");

                log("3. Attempting Read from Firestore...");
                const docSnap = await testRef.get();

                if (docSnap.exists) {
                    log("Read Successful! Data: " + JSON.stringify(docSnap.data()));
                    setStatus("success", "‚úÖ Firebase Connection Working Perfectly!");
                } else {
                    throw new Error("Write claimed success, but Read failed (Document not found).");
                }

            } catch (e) {
                log("‚ùå ERROR: " + e.message);
                console.error(e);

                if (e.code === 'permission-denied' || e.message.includes('permission')) {
                    setStatus("error", "‚õî PERMISSION DENIED: Check your Firestore Rules in Firebase Console (Start in Test Mode).");
                } else if (e.code === 'unavailable' || e.message.includes('network')) {
                    setStatus("error", "üîå NETWORK ERROR: Check your internet connection.");
                } else {
                    setStatus("error", "‚ùå FAILED: " + e.message + "\n(Code used: Compat library v9.6.1)");
                }
            }
        }

        runDiagnostics();
    </script>
</body>

</html>