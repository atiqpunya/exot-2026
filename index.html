<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXOT 2026 - Exam Oral Test | SD Islam Al-Wildan 4</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0ea5e9">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/logo.css">
</head>

<body class="landing-page">

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-background">
            <div class="hero-blob blob-1"></div>
            <div class="hero-blob blob-2"></div>
            <div class="hero-blob blob-3"></div>
        </div>

        <div class="hero-content">
            <div class="hero-text fade-in">
                <div class="hero-badge">‚ú® Exam Oral Test 2026</div>
                <h1 class="hero-title">Platform Ujian Lisan Digital</h1>
                <p class="hero-description">
                    Sistem penilaian digital untuk EXOT (Exam Oral Test) yang diselenggarakan oleh SD Islam Al-Wildan 4
                    Islamic School Jakarta. Objektif, Transparan, dan Modern.
                </p>

                <div class="hero-stats">
                    <div class="hero-stat-item">
                        <strong>3</strong>
                        <span>Mata Pelajaran</span>
                    </div>
                    <div class="hero-stat-item">
                        <strong>Real-time</strong>
                        <span>Penilaian</span>
                    </div>
                    <div class="hero-stat-item">
                        <strong>Digital</strong>
                        <span>Certificate</span>
                    </div>
                </div>
            </div>

            <!-- Login Card -->
            <div class="hero-login-card fade-in">
                <div class="login-header" style="text-align: center; margin-bottom: 2rem;">
                    <img src="img/logo-alwildan.png" alt="SD Al-Wildan 4" style="height: 80px; margin-bottom: 1rem;">
                    <h2 style="font-size: 1.5rem; color: var(--text-primary); margin-bottom: 0.5rem;">Login Sistem</h2>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Silakan login sesuai peran Anda</p>
                </div>

                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Masuk Sebagai</label>
                        <select id="loginRole" class="form-input form-select" required onchange="updateLoginUI()">
                            <option value="" disabled selected>Pilih Peran...</option>
                            <option value="admin">Admin</option>
                            <option value="panitia">Panitia</option>
                            <option value="penguji">Penguji</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="username" class="form-input" placeholder="Masukkan username" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <div class="password-wrapper" style="position: relative;">
                            <input type="password" id="password" class="form-input" placeholder="Masukkan password"
                                required>
                            <button type="button" class="password-toggle" onclick="togglePassword()"
                                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">üëÅÔ∏è</button>
                        </div>
                    </div>

                    <div id="loginError" class="alert alert-error" style="display: none; margin-bottom: 1rem;">
                        <span>‚ùå</span>
                        <span id="errorText">Username atau password salah!</span>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; margin-top: 1rem;">
                        üîê Masuk Sekarang
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Subjects Section -->
    <section class="subjects-section">
        <div class="container">
            <div class="section-title" style="text-align: center;">Mata Pelajaran Ujian</div>
            <p class="section-subtitle" style="text-align: center;">Kompetensi utama yang diujikan dalam EXOT 2026</p>

            <div class="subjects-grid">
                <div class="subject-item english">
                    <div class="subject-icon" style="color: #3b82f6; background: rgba(59, 130, 246, 0.1);">Aa</div>
                    <h3>English</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Speaking, Reading, and Comprehension
                        assessment.</p>
                </div>
                <div class="subject-item arabic">
                    <div class="subject-icon" style="color: #10b981; background: rgba(16, 185, 129, 0.1);">ÿ∂</div>
                    <h3>Arabic</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Maharah Kalam and Qiro'ah assessment.
                    </p>
                </div>
                <div class="subject-item alquran">
                    <div class="subject-icon" style="color: #f59e0b; background: rgba(245, 158, 11, 0.1);">üìñ</div>
                    <h3>Al-Quran</h3>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Tahfidz and Tahsin quality assessment.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
        <div class="container">
            <h2 class="section-title">Keunggulan Sistem EXOT</h2>
            <p class="section-subtitle">Platform modern untuk mendukung transparansi dan efisiensi ujian</p>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon" style="color: var(--primary);">‚ö°</div>
                    <h3>Real-time Scoring</h3>
                    <p style="color: var(--text-secondary);">Nilai langsung tersimpan dan dapat dilihat secara
                        real-time.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon" style="color: #8b5cf6;">üì±</div>
                    <h3>QR Attendance</h3>
                    <p style="color: var(--text-secondary);">Absensi cepat dan akurat menggunakan pemindaian QR Code.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon" style="color: #f43f5e;">üìä</div>
                    <h3>Data Analytics</h3>
                    <p style="color: var(--text-secondary);">Analisis performa siswa dengan visualisasi data yang
                        lengkap.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div>
                <div class="footer-logo">
                    <span>üìù</span> EXOT 2026
                </div>
                <p style="color: #94a3b8; line-height: 1.6; max-width: 400px;">
                    Sistem manajemen ujian lisan digital untuk meningkatkan kualitas pendidikan dan transparansi
                    penilaian di lingkungan SD Islam Al-Wildan 4.
                </p>
            </div>
            <div style="text-align: right;">
                <h4 style="color: white; margin-bottom: 1.5rem; font-size: 1.1rem;">Quick Links</h4>
                <div class="footer-links">
                    <a href="attendance.html">Absensi Siswa</a>
                    <a href="dashboard.html">Dashboard Monitoring</a>
                    <a href="register.html">Data Registrasi</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 SD Islam Al-Wildan 4 Islamic School Jakarta. All rights reserved.</p>
            <p style="margin-top: 0.5rem; font-size: 0.8rem; color: #475569;">
                Dibuat dengan ‚ù§Ô∏è oleh <a href="#" style="color: #64748b; text-decoration: none;">Muhammad Atiq Qoidul
                    Islam</a>
            </p>
        </div>
    </footer>

    <script type="module" src="js/firebase-config.js?v=1.2"></script>
    <script type="module" src="js/firebase-service.js?v=1.2"></script>
    <script src="js/storage.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Check if already logged in
            const session = getSession();
            if (session) {
                // Optional: Auto redirect content if logged in
                // redirectByRole(session);
            }

            // Check for redirect parameter
            const urlParams = new URLSearchParams(window.location.search);
            const redirect = urlParams.get('redirect');
            if (redirect) {
                sessionStorage.setItem('loginRedirect', redirect);
            }
        });

        function togglePassword() {
            const input = document.getElementById('password');
            const btn = document.querySelector('.password-toggle');
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'üôà';
            } else {
                input.type = 'password';
                btn.textContent = 'üëÅÔ∏è';
            }
        }

        function updateLoginUI() {
            // Optional: visual changes based on role
            const role = document.getElementById('loginRole').value;
        }

        function handleLogin(e) {
            e.preventDefault();

            const role = document.getElementById('loginRole').value;
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!role) {
                document.getElementById('errorText').textContent = 'Silakan pilih peran (Admin/Panitia/Penguji)!';
                document.getElementById('loginError').style.display = 'flex';
                return;
            }

            const result = login(username, password);

            if (!result) {
                document.getElementById('errorText').textContent = 'Username atau password salah!';
                document.getElementById('loginError').style.display = 'flex';
                return;
            }

            // Role Validation
            // We map internal roles to selected roles
            // admin -> panitia_utama
            // panitia -> panitia
            // penguji -> penguji

            let valid = false;
            if (role === 'admin' && result.role === 'panitia_utama') valid = true;
            else if (role === 'panitia' && result.role === 'panitia') valid = true;
            else if (role === 'penguji' && result.role === 'penguji') valid = true;

            // Allow Admin to login as Panitia for testing? No, strict for now.
            // Actually, internal 'panitia_utama' is practically 'admin'.

            if (!valid) {
                document.getElementById('errorText').textContent = `Akun ini bukan akun ${role.charAt(0).toUpperCase() + role.slice(1)}!`;
                document.getElementById('loginError').style.display = 'flex';
                return;
            }

            if (result.error) {
                document.getElementById('errorText').textContent = result.error;
                document.getElementById('loginError').style.display = 'flex';
                return;
            }

            // Check for redirect
            let redirect = sessionStorage.getItem('loginRedirect');

            // Validate redirect (Security & Bugfix)
            if (redirect && redirect.includes('exot2026.com')) {
                console.warn('Blocked invalid redirect to exot2026.com');
                sessionStorage.removeItem('loginRedirect');
                redirect = null;
            }

            if (redirect) {
                sessionStorage.removeItem('loginRedirect');
                window.location.href = redirect;
                return;
            }

            // Redirect based on role
            redirectByRole(result.role ? result : result); // login() returns session object, student manual returns result with role
        }

        function redirectByRole(session) {
            if (session.role === 'panitia_utama' || session.role === 'panitia') {
                window.location.href = 'register.html';
            } else if (session.role === 'penguji') {
                const subjectUrls = {
                    english: 'exam-english.html',
                    arabic: 'exam-arabic.html',
                    alquran: 'exam-alquran.html'
                };
                window.location.href = subjectUrls[session.subject] || 'index.html';
            } else if (session.role === 'siswa') {
                window.location.href = 'attendance.html'; // Or dashboard?
            }
        }
    </script>
    <!-- <script type="module" src="js/firebase-config.js"></script> -->
</body>

</html>